import { ListWrapper } from 'angular2/src/facade/collection';
import { ProtoChangeDetector } from './interfaces';
import { ChangeDetectorJITGenerator } from './change_detection_jit_generator';
import { coalesce } from './coalesce';
import { ProtoRecordBuilder } from './proto_change_detector';
var _jitProtoChangeDetectorClassCounter = 0;
export class JitProtoChangeDetector extends ProtoChangeDetector {
    constructor(_pipeRegistry, definition) {
        super();
        this._pipeRegistry = _pipeRegistry;
        this.definition = definition;
        this._factory = this._createFactory(definition);
    }
    static isSupported() { return true; }
    instantiate(dispatcher) {
        return this._factory(dispatcher, this._pipeRegistry);
    }
    _createFactory(definition) {
        var recordBuilder = new ProtoRecordBuilder();
        ListWrapper.forEach(definition.bindingRecords, (b) => { recordBuilder.add(b, definition.variableNames); });
        var c = _jitProtoChangeDetectorClassCounter++;
        var records = coalesce(recordBuilder.records);
        var typeName = `ChangeDetector${c}`;
        return new ChangeDetectorJITGenerator(typeName, definition.strategy, records, this.definition.directiveRecords)
            .generate();
    }
}
//# sourceMappingURL=jit_proto_change_detector.js.map